from langchain_core.prompts import ChatPromptTemplate
from langchain_core.messages import SystemMessage, HumanMessage, AIMessage  
from langchain_openai import ChatOpenAI
from dotenv import load_dotenv
load_dotenv()

transcription_text_for_summary = """ 
আসসালামু আলাইকুম গোজা এন্ড থেকে নাহিদুর বলছি আপনাকে কিভাবে সহযোগিতা করতে পারি আমি হচ্ছে আপনাদের ওয়েবসাইটে ঢুকতে পারতেছি না আপনাদের ওয়েবসাইটে কোন প্রবলেম নাকি না স্যার আমাদের ওয়েবসাইটে তো একচুয়ালি এখন বর্তমানে কোন সমস্যা হচ্ছে না আমি আপনার সাথে কথা বলতে বলতে কিন্তু আমাদের ওয়েবসাইটে প্রবেশ করলাম আমি হচ্ছে গিয়ে আপনার যেভাবে আমাকে প্রসেস গুলো করা হলো আমি একই ভাবে আপনাদের অ্যাপস টা ইন্সটল করলাম গোজা এন্ড এবং এটা থেকে আমি ঢুকতে চাচ্ছি আমি সবকিছু বুকিং কনফার্ম করে দেওয়ার পরে আমি সিঙ্গাপুরে যাব আরকি সো আমি আর আমার ওয়াইফ যাব তো সেখানে হচ্ছে যে ওয়েবসাইটে সব ঢুকতে পারতেছে যখনই আমি টিকেটের চার্জ দিচ্ছি বাট ওইখানে কিছু আসতেছে না মানে কেন এরকম হচ্ছে আমি তো বুঝি না। আচ্ছা আপনি আপনার বুকিং আইডি অথবা মেইল এড্রেসটি আমাকে একটু শেয়ার করবেন আপনার যেহেতু বুকিং করে ফেলেছেন অলরেডি আমি চেক করবো। আমি হ্যাঁ আমার ইমেইলটা দিতে পারি আপনাকে। ইমেইলটা বলবো নাকি কি হয়ে দিবো একটু মুখে বলুন আমি নোট করছি। ওকে জাস্ট মিনিট ওয়েট Okay, Okay, আমি বলতে টিম টি ই এ এম টিম ডট টি ই এম না টি ই এম টিম এম এম ফর ম্যান ওকে ইয়া ডট আর জে আপন আর জে এ পি ও এন ইয়া @gmail.com কি আপডেট করা আছে স্যার আপনার ফোনে আপডেট করা আমি তো মাত্র ইনস্টল করলাম আচ্ছা আপনি যখন প্রবেশ করছেন তখন শুধু সেখানে আপনার গোজাইন লোকো শো করছে আর কিছু শো করছে না রাইট না শো করতে আমি যাচ্ছি সবকিছু বুকিং দিচ্ছি বাট আমি চার্জ অপশনে ক্লিক করার পরে ওখানে কিছু আসতে না নো ফ্লাইট লেখা আসতে সার্চ যখন সার্চ অপশনে সিলেক্ট করছেন তাই তো কি শেয়ার করুন যে কোন রুটটি সিলেক্ট করে আপনি সার্চ করছেন আমি নিজে তো চেক করব। ওকে আমি আমি আপনাদের অ্যাপসে আমি আপনাদের হচ্ছে অ্যাপসে ঢুকলাম আমি ফ্লাইটে ক্লিক করলাম দেন আমি লেখলাম হচ্ছে ঢাকা টু বাংলাদেশ ফ্রম আমি লেখলাম সিঙ্গাপুর ওকে সিঙ্গাপুর সিঙ্গাপুর দেন হচ্ছে আমি রিট আমি হচ্ছে যাওয়ার ডেট দিলাম হচ্ছে নেক্সট ম্যানথ ডেট ফাইভ ফেব্রুয়ারি 2025 ডান দেন আমি রিটার্ন দিলাম ফেব্রুয়ারি 12 ওকে, দেন হচ্ছে আমি ট্রাভেলিং দিলাম হচ্ছে দুইজন ওদের কোন সিল্ডার নাই দেন ইকোনমি দিলাম দাম দিলাম হ্যাঁ এরপরে আমি চার্জ অপশনে ক্লিক করলাম বাট ওখানে লেখা আসছে নো ফ্লাইট পাউন্ড এখন নিচে লিখতে সামথিং ইজ রং হোয়াট আমি আপনার সাথে কথা বলতে বলতে আমাদের ডিভাইস দিয়ে কিন্তু চেক করলাম এখানে কিন্তু বেশ কিছু আলাইন এর ফ্লাইট শো করছে স্যার ঠিক আছে আমাদের অ্যাপে সেক্ষেত্রে আপনাকে রিপোর্ট করবো আপনি আপনার অ্যাপ একটিবার আনইনস্টল করে কোন আপনারা আমার ইন্সটল করুন কাইন্ডলি আমি একটা সাথে আছি প্রয়োজনে। ঠিক আছে? আপনি কি iPhone ইউজ করছেন বা iOS না না আমার এটা এন্ড্রয়েড ফোন এন্ড্রয়েড। জি সেক্ষেত্রে আমি কিন্তু আমাদের এখান থেকে এন্ড্রয়েড ডিভাইস দিয়ে কিন্তু চেক করলাম আপনার সাথে কথা বলতে বলতে কিন্তু আমি চেক করছি স্যার এবং সার্চ করার মাত্র দেখতে পাচ্ছি IndiGo এয়ারলাইন্সের ফ্লাইট শো করছে দেন হচ্ছে সিঙ্গাপুর এয়ারলাইন্সের ফ্লাইট আছে বেশ কিছু এয়ারলাইন্সের ফ্লাইট কিন্তু চলে এসেছে সামনে স্যার। ঠিক আছে? আপনি একটু রিকোয়েস্ট করবো আপনি আপনার অ্যাপটি প্রয়োজনে আনইনস্টল করে কোনটা আবার ওটি ইন্সটল করুন। দেন আপনি একটু একটু চেক করে দেখুন আমি ভাইর সাথে কথা বললাম উনি আমাকে এটা বললো জাপান এটা থেকে আসলে ভালো ভাবে কাটা যায় আরকি যে উনাকে হয়তো আপনি চিনবেন বিমানের টিকেট খাওয়া কিন্তু খুবই সহজ হয় তো একটা স্মার্টফোন দিয়ে আপনিও কিন্তু খুব সহজে বিমানের টিকেট কেটে ফেলতে পারেন চলুন আপনাদেরকে প্রসেসটা দেখি ফাস্ট অফ আপনারা চলে যাবেন Google Play ওনার থেকে আমি আসলে করতে স্যার আমাদের এখান থেকে তো আমি চেক করলাম হচ্ছে বাট হয়ে যায়। গো জানি। হুম হুম গো জানি হ্যাঁ? জি জি জি। ওকে। ট্রাই এগেইন। আমি হচ্ছে কন্টিনিউ উইথ Google দিয়ে দিচ্ছি, ওকে? জি দিতে পারেন কোন সমস্যা নেই। দেন হচ্ছে আমি একটা Google সিলেক্ট করে দিলাম। ইমেইল সিলেক্ট করলাম। জি জি। এলাও দিলাম। ডিরেক্টলি চলে আসছে। কিন্তু ওই ছেলে চাওয়ার পরে আমি আবারও পুনরায় সবকিছু দেই। ওকে দিচ্ছি। সিঙ্গাপুর 5 এ ফেব্রুয়ারি জার্নি এবং রিটার্ন হচ্ছে 12 এ ফেব্রুয়ারি দুইজন প্যাসেঞ্জার ইকোনমি। ফেব্রুয়ারি 5 2025 ও মাই গড দিস ইজ সেম প্রবলেম করতে পাচ্ছি না আপনি একটু স্ক্রিনসহট এখনো স্ক্রিনসহট নিয়ে আমাদের Facebook এর পেজ আছে গোজায়ন এর আপনি সেখানে গিয়ে একটু Messenger এ শেয়ার করে দিবেন আমি এখনো চেক করে আমাদের টিমকে ইনফর্ম করে দিচ্ছি আর আপনি একটু ওয়েবসাইট থেকে ডিরেক্টলি তাহলে একটু ট্রাই করে দিবেন আশা করছি ওয়েবসাইট থেকে হবে ঠিক আছে আর আপনার ডিভাইস নাম ওয়েবসাইট থেকে ট্রাই করে দিচ্ছি না হয় নি ওয়েবসাইট থেকে হচ্ছে না স্যার বাট আমাদের কিন্তু আপনার সাথে কথা বলতে বলতে আমাদের ওয়েবসাইট থেকে ট্রাই করলাম আমাদের ওয়েবসাইট কিন্তু হচ্ছে স্যার আরে ডোন্ট মনে না মেয়েরে ব্যাড লাক আচ্ছা আমি ইয়েতে যাইয়া দেখি আমার ফেসবুক এর নাম হচ্ছে আরজি আপু। জি জি আপনি হচ্ছে যে আমাদেরকে একটু ফেসবুক মেসেঞ্জার যদি পোসিবল হয় আপনার ফেসবুক নাম কি? জাস্ট গোজা আইন লিখে সার্চ করলে আমাদের ফেসবুক পেজটি কিন্তু পেয়ে যাবেন। সেখানে মেসেঞ্জার একটু শেয়ার করে দিয়ে আমি এখনই আমাদের টিমকে ইনফরম করে দিচ্ছি স্যার। ওকে ঠিক আছে। ফোনের ডিভাইস হচ্ছে যেটি আছে ফোনের ডিভাইস দেন আপনার অ্যাপ এন্ড্রয়েড ভার্সন ঠিক আছে আপনার অ্যাপের ভার্সন অ্যাপের ভার্সন যদি কাইন্ডলি আমাদের কিছু শেয়ার করে দেন আমি আমাদের টিমকে এখন ইনফরম করে দিতে পারছিলাম স্যার। আচ্ছা ঠিক তো আমি সেন্ড করতেছি। আমি সাথে আছি। আপনি থাকবেন? জি জি আপনি আমি সাথে আছি আমি এখনই চেক করছি স্যার আপনি শেয়ার করে দিলাম দেখছি আপনি এখান থেকে। হ্যাঁ হ্যাঁ হ্যাঁ হ্যাঁ হ্যাঁ আমি এপ থেকে যেহেতু বললাম আমি এপ থেকে ট্রাই করলাম। এপেও কিন্তু কোন প্রবলেম নেই ইনজেনারিলি। আর দেখা অল্টারনেটিভ হিসেবে যদি এপে কোন ভাবে কাজ না হয় অল্টারনেটিভ হিসেবে কিন্তু ওয়েবসাইটে কিন্তু দেখা যাচ্ছে যে চেক করলে কিন্তু হয় স্যার। ঠিক আছে? আচ্ছা আমি আপনাদের ইয়েতে গিয়েছিলাম ওয়েবসাইটের লিংক আছে ওয়েবসাইটে ঢুকে দেখবো? এই ফোন থেকে করে দেখি। আরেকটা ফোন থেকে করে দেখি। ডিভাইস টি চেঞ্জ করে দেখুন। আপনার ফোনে কি কোন ভিপিএন অন করা আছে স্যার? না কোন ভিপিএন আচ্ছা আমি এটাকে একটু ট্রাই করি দেখি এটা কি হয় কিনা। অন্য ডিভাইসে একই পানি কিন্তু ব্রাউজারে গিয়ে একটু গোজার লিখে সার্চ করে দেখুন আশা করছি পেয়ে যাবেন স্যার। হ্যাঁ আমি দেখি এটা হয় কিনা। জি জি জি সিঙ্গাপুর সিঙ্গাপুর দিই আমি এটা হচ্ছে ফেব্রুয়ারি জানুয়ারি ফেব্রুয়ারি ফাইভ ডান টু 12 ইকোনমি টান আই হোপ কিছু বাকি নাই আপনার কোন মানুষের কাজ চলে সেটি কিন্তু আমরা জানতে পারি বা ওয়েবসাইটে যদি কোন মানুষের কাজ চলে যার কোন আপনার কাজ করলে পাবেন না এটা কিন্তু আমাদের কিন্তু থেকে খুব ভালোভাবে হয়ে গেছে ঢোকা মাত্র হয়ে গেছে ওকে আমি দেখি হ্যাঁ থ্যাংক ইউ সো মাচ ফর হেল্প আসসালামুকুম ওয়ালাইকুম আসসালাম অন্য কোন ইনফরমেশন জানিয়ে সহযোগিতা করতে পারি আচ্ছা আমি জানাবো আপনাকে ঠিক আছে কথা হচ্ছিল নাহিদুরের সাথে হ্যাঁ
  """

# Define system and human messages separately for better readability
system_message = """You are a Summarizer expert AI assistant in Bangla language. 
Always summarize the text in Bangla with points."""

human_message = """আপনার কাছে একটি বাংলা অডিও ট্রান্সক্রিপশন রয়েছে যা একটি কল সেন্টার প্রতিনিধি এবং একজন গ্রাহকের মধ্যে কথোপকথনকে উপস্থাপন করে।
অনুগ্রহ করে নিম্নলিখিত মূল পয়েন্টগুলি অন্তর্ভুক্ত করে একটি সংক্ষিপ্ত সারাংশ তৈরি করুন:

1. গ্রাহকের বিস্তারিত তথ্য
2. গ্রাহকের প্রশ্ন
3. এজেন্টের দ্বারা প্রদত্ত সমাধান
4. গ্রাহকের কোনো ফলো-আপ প্রশ্ন (যদি থাকে)
5. এজেন্টের দ্বারা প্রদত্ত সমাধান
5. তাদের মধ্যে অন্যানো গুরুত্বপূর্ণ আলোচনা (যদি থাকে)

ট্রান্সক্রিপশন:
{text}"""


# Create the chat template
chat_template = ChatPromptTemplate.from_messages([
    ("system", system_message),
    ("human", human_message)
])

# format the chat template with the transcription text
format_chat_template = chat_template.format_messages(text=transcription_text_for_summary)

# create the chat model
llm = ChatOpenAI(
    model="gpt-4o",
)

print(f'full formated prompt: {format_chat_template}')


print("generating the summary...")
# generate the answer
response = llm.invoke(format_chat_template)
print("\n--- Answer ---")
print(response.content)
# save the response to a file with UTF-8 encoding
with open("SummaryAIresponse1.txt", "w", encoding="utf-8") as f:
    f.write(response.content)
